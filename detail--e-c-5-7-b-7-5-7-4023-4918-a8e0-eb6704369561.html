<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Script Detail</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <header>
      <h1>Script Detail</h1>
      <button id="backButton" class="back-button">â† Back</button>
    </header>

    <main id="detailContent">
      <h2 id="detailTitle">Kimi é€‰æ‹©æ€§åˆ é™¤å†å²ä¼šè¯</h2>

      
        <p><strong>namespace:</strong> </p>
      
        <p><strong>version:</strong> 1.1</p>
      
        <p><strong>description:</strong> åœ¨ Kimi èŠå¤©è®°å½•é¡µé¢ä¸ºæ¯ä¸ªä¼šè¯æ·»åŠ å•é€‰æ¡†ï¼Œå¹¶æä¾›ä¸€ä¸ªç¾è§‚çš„åˆ é™¤æŒ‰é’®ï¼Œå®ç°é€‰æ‹©æ€§åˆ é™¤å†å²ä¼šè¯ã€‚</p>
      
        <p><strong>author:</strong> å…­è®°</p>
      
        <p><strong>match:</strong> https://kimi.ai/chat/*</p>
      
        <p><strong>id:</strong> -e-c-5-7-b-7-5-7-4023-4918-a8e0-eb6704369561</p>
      
        <p><strong>filePath:</strong> scripts/Kimi é€‰æ‹©æ€§åˆ é™¤å†å²ä¼šè¯.user.js</p>
      
        <p><strong>downloadLink:</strong> https://raw.githubusercontent.com/ACG-Q/UserScript/main/scripts/Kimi é€‰æ‹©æ€§åˆ é™¤å†å²ä¼šè¯.user.js</p>
      

      <p><strong>content:</strong></p>
      <pre>// ==UserScript==
// @name         Kimi é€‰æ‹©æ€§åˆ é™¤å†å²ä¼šè¯
// @namespace
// @version      1.1
// @description  åœ¨ Kimi èŠå¤©è®°å½•é¡µé¢ä¸ºæ¯ä¸ªä¼šè¯æ·»åŠ å•é€‰æ¡†ï¼Œå¹¶æä¾›ä¸€ä¸ªç¾è§‚çš„åˆ é™¤æŒ‰é’®ï¼Œå®ç°é€‰æ‹©æ€§åˆ é™¤å†å²ä¼šè¯ã€‚
// @author       å…­è®°
// @match        https://kimi.ai/chat/*
// @icon         https://kimi.ai/favicon.ico
// ==/UserScript==

(function () {
  &#34;use strict&#34;;

  /**
   *  æ·»åŠ å•é€‰æ¡†åˆ°å†å²ä¼šè¯
   */
  function addRadioButtonsToChatLinks() {
    const chatLinks = document.querySelectorAll(&#34;.history-chat&#34;);

    if (chatLinks.length === 0) {
      return;
    }

    chatLinks.forEach((link) =&gt; {
      if (link.querySelector(&#34;.chat-select-radio&#34;)) return; // é˜²æ­¢é‡å¤æ·»åŠ 

      const radio = document.createElement(&#34;input&#34;);
      radio.type = &#34;radio&#34;;
      radio.name = &#34;chat-select&#34;;
      radio.classList.add(&#34;chat-select-radio&#34;);

      // åˆ›å»ºæ ‡ç­¾ï¼ˆå¯é€‰ï¼‰
      const label = document.createElement(&#34;label&#34;);
      label.textContent = &#34; é€‰æ‹©&#34;;
      label.style.marginLeft = &#34;5px&#34;;
      label.style.color = &#34;#999&#34;;
      label.style.fontSize = &#34;14px&#34;;

      const chatInfo = link.querySelector(&#34;.history-chat-info&#34;);
      if (chatInfo) {
        chatInfo.appendChild(radio);
        chatInfo.appendChild(label);

        // é˜»æ­¢ç‚¹å‡»å•é€‰æ¡†æ—¶è§¦å‘ a æ ‡ç­¾çš„è·³è½¬
        radio.addEventListener(&#34;click&#34;, function (event) {
          event.stopPropagation();
        });
      }
    });

    console.log(&#34;æ³¨å…¥æˆåŠŸ....&#34;);
  }

  /**
   * åˆ é™¤é€‰ä¸­çš„ä¼šè¯
   */
  async function deleteSelectedChats() {
    const selectedChat = document.querySelector(&#34;.chat-select-radio:checked&#34;);

    if (!selectedChat) {
      alert(&#34;âš ï¸ è¯·é€‰æ‹©è¦åˆ é™¤çš„ä¼šè¯ï¼&#34;);
      return;
    }

    const chatId = selectedChat
      .closest(&#34;.history-chat&#34;)
      .getAttribute(&#34;href&#34;)
      .split(&#34;/&#34;)
      .pop();
    if (!chatId) {
      alert(&#34;âŒ æœªèƒ½è·å–ä¼šè¯ IDï¼Œåˆ é™¤å¤±è´¥ï¼&#34;);
      return;
    }

    // è·å–æˆæƒä¿¡æ¯
    const authHeader = localStorage.getItem(&#34;access_token&#34;);
    if (!authHeader) {
      alert(&#34;âš ï¸ æ— æ³•è·å–æˆæƒä¿¡æ¯ï¼Œè¯·ç¡®ä¿å·²ç™»å½• Kimi&#34;);
      return;
    }

    const headers = {
      accept: &#34;application/json, text/plain, */*&#34;,
      authorization: `Bearer ${authHeader}`,
      &#34;x-msh-platform&#34;: &#34;web&#34;,
      &#34;x-language&#34;: &#34;zh-CN&#34;,
      origin: &#34;https://kimi.ai&#34;,
      referer: &#34;https://kimi.ai/chat/empty&#34;,
      &#34;user-agent&#34;: navigator.userAgent,
      dnt: &#34;1&#34;,
    };

    // åˆ é™¤è¯·æ±‚
    try {
      const response = await fetch(`https://kimi.ai/api/chat/${chatId}`, {
        method: &#34;DELETE&#34;,
        headers: headers,
      });

      if (response.ok) {
        alert(`âœ… æˆåŠŸåˆ é™¤ä¼šè¯ ID: ${chatId}`);
        selectedChat.closest(&#34;.history-chat&#34;).remove();
      } else {
        alert(`âŒ åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•ï¼`);
      }
    } catch (error) {
      console.error(&#34;åˆ é™¤ä¼šè¯æ—¶å‘ç”Ÿé”™è¯¯:&#34;, error);
      alert(&#34;âŒ åˆ é™¤ä¼šè¯æ—¶å‡ºç°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åå†è¯•ã€‚&#34;);
    }
  }

  /**
   * åˆ›å»ºå¹¶æ·»åŠ åˆ é™¤æŒ‰é’®
   */
  function createDeleteButton() {
    const existingButton = document.getElementById(&#34;delete-selected-chat-btn&#34;);
    if (existingButton) return; // é˜²æ­¢é‡å¤æ·»åŠ 

    const button = document.createElement(&#34;button&#34;);
    button.id = &#34;delete-selected-chat-btn&#34;;
    button.textContent = &#34;ğŸ—‘ï¸ åˆ é™¤é€‰ä¸­çš„ä¼šè¯&#34;;
    button.style.position = &#34;fixed&#34;;
    button.style.bottom = &#34;30px&#34;; // å¢åŠ åº•éƒ¨é—´è·
    button.style.right = &#34;30px&#34;; // å¢åŠ å³ä¾§é—´è·
    button.style.background = &#34;linear-gradient(145deg, #ff4d4f, #d9363e)&#34;; // æ¸å˜èƒŒæ™¯
    button.style.color = &#34;white&#34;;
    button.style.border = &#34;none&#34;;
    button.style.padding = &#34;12px 18px&#34;;
    button.style.borderRadius = &#34;12px&#34;;
    button.style.fontSize = &#34;16px&#34;;
    button.style.fontWeight = &#34;bold&#34;;
    button.style.cursor = &#34;pointer&#34;;
    button.style.boxShadow = &#34;0 4px 8px rgba(0, 0, 0, 0.2)&#34;;
    button.style.transition = &#34;background 0.3s ease, transform 0.2s ease&#34;;
    button.style.zIndex = &#34;9999&#34;;
    button.style.display = &#34;none&#34;;

    button.onmouseover = () =&gt; {
      button.style.background = &#34;linear-gradient(145deg, #d9363e, #ff4d4f)&#34;;
      button.style.transform = &#34;scale(1.05)&#34;;
    };
    button.onmouseout = () =&gt; {
      button.style.background = &#34;linear-gradient(145deg, #ff4d4f, #d9363e)&#34;;
      button.style.transform = &#34;scale(1)&#34;;
    };

    button.addEventListener(&#34;click&#34;, deleteSelectedChats);
    document.body.appendChild(button);

    // ç›‘å¬ history-modal-container æ˜¯å¦æ˜¾ç¤º
    const observer = new MutationObserver(() =&gt; {
      const modals = document.getElementsByClassName(&#34;history-modal-container&#34;);
      if (
        modals &amp;&amp;
        modals.length &gt; 0 &amp;&amp;
        getComputedStyle(modals[0]).display !== &#34;none&#34;
      ) {
        button.style.display = &#34;block&#34;;
      } else {
        button.style.display = &#34;none&#34;;
      }
    });

    observer.observe(document.body, { childList: true, subtree: true });
  }

  /**
   * é¡µé¢åŠ è½½æ—¶è¿è¡Œ
   */
  function init() {
    addRadioButtonsToChatLinks();
    createDeleteButton();

    // ç›‘å¬åŠ¨æ€åŠ è½½ï¼ˆé€‚ç”¨äº AJAX æ¸²æŸ“ï¼‰
    const observer = new MutationObserver(() =&gt; {
      addRadioButtonsToChatLinks();
    });

    observer.observe(document.body, { childList: true, subtree: true });
  }

  // å»¶è¿Ÿ 1 ç§’åˆå§‹åŒ–ï¼Œç¡®ä¿é¡µé¢åŠ è½½å®Œæˆ
  setTimeout(init, 1000);
})();
</pre>
    </main>
  </div>

  <script>
    // è¿”å›é¦–é¡µ
    document.getElementById('backButton').addEventListener('click', () => {
      window.history.back();
    });
  </script>
</body>
</html>