<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Script Detail</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <header>
      <h1>Script Detail</h1>
      <button id="backButton" class="back-button">← Back</button>
    </header>

    <main id="detailContent">
      <h2 id="detailTitle">Steam创意工坊mod下载工具</h2>

      
        <p><strong>namespace:</strong> </p>
      
        <p><strong>version:</strong> 1.2</p>
      
        <p><strong>description:</strong> 在创意工坊中注入一个MOD下载按钮，用于下载MOD，支持下载合集, API来源：https://steamworkshopdownloader.io/</p>
      
        <p><strong>author:</strong> 六记(原:极品小猫)</p>
      
        <p><strong>include:</strong> https://steamcommunity.com/sharedfiles/filedetails/*,https://steamcommunity.com/id/*/myworkshopfiles/*,https://steamcommunity.com/workshop/filedetails/*</p>
      
        <p><strong>match:</strong> https://steamworkshopdownloader.io/*</p>
      
        <p><strong>connect:</strong> *.steamworkshopdownloader.io</p>
      
        <p><strong>grant:</strong> GM_setClipboard,GM_download,GM_xmlhttpRequest</p>
      
        <p><strong>id:</strong> -7-c-c-e-b-2-f-6--10e3-4298-860d-bc2a0b5e00a3</p>
      
        <p><strong>filePath:</strong> scripts/Steam创意工坊mod下载工具.user.js</p>
      
        <p><strong>downloadLink:</strong> https://raw.githubusercontent.com/ACG-Q/UserScript/main/scripts/Steam创意工坊mod下载工具.user.js</p>
      

      <p><strong>content:</strong></p>
      <pre>// ==UserScript==
// @name         Steam创意工坊mod下载工具
// @namespace
// @version      1.2
// @description  在创意工坊中注入一个MOD下载按钮，用于下载MOD，支持下载合集, API来源：https://steamworkshopdownloader.io/
// @author       六记(原:极品小猫)
// @include      https://steamcommunity.com/sharedfiles/filedetails/*
// @include      https://steamcommunity.com/id/*/myworkshopfiles/*
// @include      https://steamcommunity.com/workshop/filedetails/*
// @match        https://steamworkshopdownloader.io/*
// @connect      *.steamworkshopdownloader.io
// @grant        GM_setClipboard
// @grant        GM_download
// @grant        GM_xmlhttpRequest
// ==/UserScript==

(function () {
  &#34;use strict&#34;;

  // 控制API链接
  let urls = [
    &#34;https://backend-01-prd.steamworkshopdownloader.io/api/details/file&#34;,
    &#34;https://backend-02-prd.steamworkshopdownloader.io/api/details/file&#34;,
    &#34;https://backend-03-prd.steamworkshopdownloader.io/api/details/file&#34;,
  ];
  let getUUids = [
    &#34;https://backend-01-prd.steamworkshopdownloader.io/api/download&#34;,
    &#34;https://backend-02-prd.steamworkshopdownloader.io/api/download&#34;,
    &#34;https://backend-03-prd.steamworkshopdownloader.io/api/download&#34;,
  ];
  let TIMEOUT = 60; // 秒
  let startMid = &#34;&#34;,
    collectionName = &#34;&#34;;
  let webHost = location.host,
    webPath = location.pathname;

  if (webHost == &#34;steamcommunity.com&#34;) {
    if (webPath.search(&#34;myworkshopfiles&#34;) &gt; -1) {
      document
        .querySelectorAll(&#39;[id^=&#34;Subscription&#34;]&#39;)
        .forEach(function (e, i) {
          console.log(i, e, e.id);
          let mid = e.id.replace(/^[^\d]+/i, &#34;&#34;),
            actionsCtn = e.querySelector(&#34;.actionsCtn&#34;);

          let down_A = document.createElement(&#34;a&#34;);
          down_A.className = &#34;download_Mod&#34;;
          down_A.target = &#34;_blank&#34;;
          down_A.textContent = &#34;下载 MOD&#34;;

          let down_span = document.createElement(&#34;span&#34;);
          down_span.className = &#34;general_btn&#34;;
          down_span.style.width = &#34;70px&#34;;
          down_span.appendChild(down_A);

          actionsCtn.appendChild(down_span);

          down_A.addEventListener(&#34;click&#34;, function () {
            ModDownloadAjax(mid);
          });
        });
    } else {
      //workshop详细页
      let down_A = document.createElement(&#34;a&#34;);
      //down_A.href=&#34;https://t.vvwall.com/#&#34;+publishedfileid;
      down_A.id = &#34;download_Mod&#34;;
      down_A.target = &#34;_blank&#34;;
      down_A.textContent = &#34;下载 MOD&#34;;
      let down_span = document.createElement(&#34;span&#34;);
      down_span.className = &#34;general_btn share tooltip&#34;;
      down_span.id = &#34;download_ModBtn&#34;;
      down_span.appendChild(down_A);

      document.querySelector(&#34;#ItemControls&#34;).appendChild(down_span);
      document
        .querySelector(&#34;#download_ModBtn&#34;)
        .addEventListener(&#34;click&#34;, function () {
          startMid = publishedfileid;
          ModDownloadAjax(publishedfileid);
        });
    }

    // https://backend-01-prd.steamworkshopdownloader.io/api/details/file
    // POST []
    function ModDownloadAjax(mid, url, isCollection) {
      isCollection = isCollection ? isCollection : true;
      url = url ? url : urls[0];
      GM_xmlhttpRequest({
        url: url,
        method: &#34;post&#34;,
        data: `[${mid}]`,
        responseType: &#34;json&#34;,
        onload: function (e) {
          console.log(e);
          if (!e.response) {
            console.log(`获取MOD失败 启动最后的手段`);
            endModDown(
              startMid,
              `[workshop-${startMid}]${collectionName ? collectionName : &#34;&#34;}.zip`,
            );
            return;
          }
          let data = e.response[0],
            downloadTitle = `[workshop-${mid}]${data.title}.zip`;
          // 是否为合集
          if (data.children &amp;&amp; isCollection) {
            collectionName = data.title;
            data.children.map((items) =&gt; {
              let mid = items.publishedfileid;
              ModDownloadAjax({ mid: mid, isCollection: false });
            });
          } else if (data.file_url) {
            GM_download({
              url: data.file_url,
              name: downloadTitle,
              saveAs: true,
              timeout: TIMEOUT * 1000,
              ontimeout: function () {
                console.log(`超时...`);
                // 将文件名设置到系统剪贴板
                GM_setClipboard(downloadTitle);
                console.log(&#34;复制完成, 打开下载链接&#34;);
                // 打开下载链接
                window.open(data.file_url);
              },
            });
          } else {
            let nextUrlIndex = urls.indexOf(url) + 1;
            if (nextUrlIndex &lt; urls.length) {
              console.log(
                `${url} --&gt; 获取MOD失败 正在切换至 ${urls[nextUrlIndex]} 进行尝试`,
              );
              ModDownloadAjax(mid, urls[nextUrlIndex]);
            } else {
              console.log(`${url} --&gt; 获取MOD失败 启动最后的手段`);
              endModDown(mid, downloadTitle);
            }
          }
        },
        onerror: function (e) {
          console.error(&#34;error&#34;, e);
        },
      });
    }

    function endModDown(mid, downloadTitle, url) {
      let data = `{&#34;publishedFileId&#34;:${mid},&#34;collectionId&#34;:null,&#34;extract&#34;:false,&#34;hidden&#34;:false,&#34;direct&#34;:false,&#34;autodownload&#34;:false}`;
      url = url ? url : getUUids[0];
      GM_xmlhttpRequest({
        url: `${url}/request`,
        method: &#34;post&#34;,
        data: data,
        responseType: &#34;json&#34;,
        onload: function (e) {
          console.log(e);
          if (!e.response) {
            alert(`获取UUID失败`);
            return;
          }
          console.log(
            `获取UUID成功\nmid: ${mid}\nuuid: ${e.response.uuid}\ntitle: ${downloadTitle}`,
          );
          if (e.response.uuid) {
            console.log(`${url}/transmit?uuid=${e.response.uuid}`);
            GM_download({
              url: `${url}/transmit?uuid=${e.response.uuid}`,
              name: downloadTitle,
              saveAs: true,
              timeout: TIMEOUT * 1000,
              ontimeout: function () {
                console.log(`超时...`);
                // 将文件名设置到系统剪贴板
                GM_setClipboard(downloadTitle);
                console.log(&#34;复制完成, 打开下载链接&#34;);
                // 打开下载链接
                window.open(`${url}/transmit?uuid=${e.response.uuid}`);
              },
            });
          } else {
            let nextUrlIndex = getUUids.indexOf(url) + 1;
            if (nextUrlIndex &lt; getUUids.length) {
              console.log(
                `${url} --&gt; 获取UUID失败 正在切换至 ${getUUids[nextUrlIndex]} 进行尝试`,
              );
              ModDownloadAjax(mid, downloadTitle, getUUids[nextUrlIndex]);
            } else {
              alert(`${url} --&gt; 获取UUID失败 ==&gt; 下载MOD失败`);
            }
          }
        },
        onerror: function (e) {
          console.error(&#34;error&#34;, e);
        },
      });
    }
  }
})();
</pre>
    </main>
  </div>

  <script>
    // 返回首页
    document.getElementById('backButton').addEventListener('click', () => {
      window.history.back();
    });
  </script>
</body>
</html>